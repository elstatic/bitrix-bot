---
name: setup-env
description: "Настройка окружения проекта. Активируется при: настроить окружение, setup env, задать вебхук, webhook, настройка .env, подключить битрикс"
---

# Setup Environment Skill

Skill для настройки переменных окружения проекта.

## Когда активируется

Пользователь хочет задать вебхук, настроить окружение, подключить Битрикс24 или указать свои данные для API.

## Что делать

### 1. Спросить вебхук

Если пользователь не указал вебхук в сообщении, спроси через `AskUserQuestion`:

> Укажите ваш Bitrix24 Webhook URL (формат: `https://ваш-домен.bitrix24.ru/rest/USER_ID/WEBHOOK_CODE/`)

### 2. Спросить папки с проектами

Спроси через `AskUserQuestion`:

> В каких папках лежат ваши git-проекты?

Варианты:
- **~/Projects (по умолчанию)** — стандартная папка
- **Указать свои** — пользователь введёт список папок

Если пользователь выбрал «Указать свои», попроси ввести пути (через запятую, пробел или по одному). Сконвертируй в формат с разделителем `:` для переменной `PROJECTS_DIRS`.

Примеры:
- Ввод: `~/Projects, ~/work/clients` → `PROJECTS_DIRS="~/Projects:~/work/clients"`
- Ввод: `~/Projects` → `PROJECTS_DIRS="~/Projects"`
- По умолчанию → `PROJECTS_DIRS="~/Projects"`

### 3. Создать или обновить `.env`

Файл `.env` находится в корне проекта. Формат:

```
export BITRIX24_WEBHOOK_URL="https://ваш-домен.bitrix24.ru/rest/USER_ID/WEBHOOK_CODE/"
export PROJECTS_DIRS="~/Projects"
```

- Если `.env` уже существует — обнови только строки `BITRIX24_WEBHOOK_URL` и `PROJECTS_DIRS`, остальные переменные не трогай.
- Если `.env` не существует — создай его.

### 4. Добавить `.env` в `.gitignore`

Проверь, что `.env` указан в `.gitignore`. Если нет — добавь строку `.env` в конец файла. Если `.gitignore` не существует — создай его с содержимым:

```
.env
```

### 5. Проверить подключение

После сохранения вебхука выполни тестовый запрос:

```bash
source .env && curl -s "${BITRIX24_WEBHOOK_URL}profile.json"
```

Если запрос вернул данные пользователя — сообщи об успехе и покажи имя подключённого аккаунта.

Если ошибка — сообщи пользователю и предложи проверить URL.

### 6. Подтверждение

После успешной настройки выведи:

```
Окружение настроено:
- .env создан (вебхук сохранён)
- Папки с проектами: [значение PROJECTS_DIRS]
- .gitignore обновлён (.env не попадёт в git)
- Подключение проверено: [имя пользователя]
```
