# Субагенты проекта

В проекте доступны три субагента. Вызываются через `Task` tool.

## activity-data-collector

**Назначение**: сбор сырых данных об активности в **текущем проекте** (git-коммиты, изменённые файлы, ветки).

**Когда использовать**:
- Пользователь спрашивает, что он делал в текущем проекте за период
- Нужны сырые данные (коммиты, diff-статистика) для дальнейшего анализа или отчёта
- Подготовка данных для формирования отчётов по одному проекту

**Вызов**:
```
Task(
  subagent_type: "activity-data-collector",
  prompt: "Собери данные об активности за период с YYYY-MM-DD по YYYY-MM-DD",
  description: "Collect activity data"
)
```

**Что возвращает**: сырой вывод без обработки — git log, изменённые файлы, ветки, статистика сбора. Данные нужно самостоятельно анализировать и форматировать.

**Модель**: sonnet (быстрый, дешёвый).

**Ключевые особенности**:
- Работает только с текущим проектом (cwd)
- Не суммаризирует — возвращает raw data
- Включает пустые секции, если данных нет
- Не задаёт уточняющих вопросов — интерпретирует период самостоятельно

---

## project-activity-digest

**Назначение**: сканирование **всех проектов** в папках из `PROJECTS_DIRS` (`.env`) и формирование готовой сводки.

**Когда использовать**:
- Пользователь спрашивает, чем занимался в целом (across all projects)
- Нужна готовая сводка по всем проектам с группировкой
- В скилле `weekly-review` — для секции «Проекты (локальная разработка)»

**Вызов**:

Перед вызовом прочитай `PROJECTS_DIRS` из `.env` и передай значение в промпте:
```bash
source .env && echo "$PROJECTS_DIRS"
```

```
Task(
  subagent_type: "project-activity-digest",
  prompt: "Покажи активность в проектах за период с YYYY-MM-DD по YYYY-MM-DD. Папки с проектами: <ЗНАЧЕНИЕ_PROJECTS_DIRS>",
  description: "Project activity digest"
)
```

**ВАЖНО**: НЕ используй `run_in_background: true` — в фоновом режиме субагент не может получить доступ к инструментам.

**Что возвращает**: готовую отформатированную сводку на русском — по каждому активному проекту: что сделано, количество коммитов и файлов. Можно вставлять в отчёт как есть.

**Модель**: sonnet.

**Ключевые особенности**:
- Сканирует проекты в папках из `PROJECTS_DIRS` в `.env` (по умолчанию `~/Projects`)
- Принимает папки через промпт (приоритетнее `.env`) — это надёжнее, т.к. не требует доступа к файловой системе
- Кеширует список проектов в `~/.cache/project-activity-digest/`
- Группирует коммиты по смыслу (не перечисляет каждый)
- Пропускает неактивные проекты
- Возвращает готовый текст на русском

---

## chat-digest

**Назначение**: загрузка чатов Битрикс24, пагинация сообщений, фильтрация по дате и формирование готовой выжимки переписок.

**Когда использовать**:
- В скиллах `daily-review` и `weekly-review` — для секции «Переписки» / «Ключевые переписки»
- Когда нужен готовый дайджест чатов Битрикс24 за период

**Вызов**:

Caller должен заранее получить webhook URL из `.env` и данные профиля пользователя, затем передать всё в промпте:

```
Task(
  subagent_type: "chat-digest",
  prompt: "Сформируй дайджест переписок Битрикс24.
    BITRIX24_WEBHOOK_URL: https://domain.bitrix24.ru/rest/ID/CODE/
    USER_ID: 123
    USER_NAME: Иван Иванов
    Период: с 2026-02-04 по 2026-02-04
    Лимит чатов: 20
    Топ диалогов: 15",
  description: "Chat digest"
)
```

**ВАЖНО**: НЕ используй `run_in_background: true` — в фоновом режиме субагент не может получить доступ к инструментам.

**Что возвращает**: готовую отформатированную выжимку переписок на русском — по каждому активному диалогу: тема, договорённости, ожидает ли реакции. Можно вставлять в отчёт как есть.

**Модель**: sonnet.

**Ключевые особенности**:
- Самостоятельно делает API-вызовы к Битрикс24 (im.recent.list, im.dialog.messages.get)
- Пагинирует сообщения (до 5 страниц по 20 сообщений на диалог)
- Фильтрует по дате, исключает служебные чаты и монологи
- Выделяет договорённости и решения
- Параметры (webhook, user ID, лимиты) приходят через промпт — `source .env` не нужен
- Возвращает готовый текст на русском

---

## Когда какой агент выбирать

| Сценарий | Агент |
|----------|-------|
| «Что я делал в этом проекте?» | `activity-data-collector` |
| «Что я делал на неделе?» (все проекты) | `project-activity-digest` |
| Скилл `daily-review` / `weekly-review`, секция «Проекты» | `project-activity-digest` |
| Скилл `daily-review` / `weekly-review`, секция «Переписки» | `chat-digest` |
| Нужен дайджест чатов Битрикс24 за период | `chat-digest` |
| Нужны сырые данные для своего анализа | `activity-data-collector` |
| Нужна готовая сводка для пользователя | `project-activity-digest` |
