# Bitrix Bot

Claude Code skills для работы с Битрикс24 через CLI: задачи, чаты, обзоры дня и недели.

## Требования

- **[Claude Code](https://docs.anthropic.com/en/docs/claude-code)** — CLI-инструмент от Anthropic для работы с Claude из терминала. Скиллы этого репозитория работают только внутри Claude Code.
- **Подписка Claude** — Pro ($20/мес) или Max ($100/$200/мес). Claude Code использует токены из подписки.
- **Битрикс24** — корпоративный портал с доступом к REST API (входящий вебхук).

## Быстрый старт

### 1. Установить Claude Code

```bash
npm install -g @anthropic-ai/claude-code
```

После установки авторизуйтесь:

```bash
claude
```

При первом запуске откроется браузер для входа в аккаунт Anthropic.

### 2. Клонировать репозиторий

```bash
git clone https://github.com/elstatic/bitrix-bot.git
cd bitrix-bot
```

### 3. Создать вебхук Битрикс24

1. Открыть Битрикс24: **Приложения** → **Разработчикам** → **Другое** → **Входящий вебхук**
2. Выбрать **права доступа** (scopes):
   - `task` — задачи
   - `im` — мессенджер (чаты)
   - `calendar` — календарь (встречи)
   - `user` — пользователи (для profile)
   - `crm` — CRM (опционально)
3. Нажать **Сохранить**
4. Скопировать URL вебхука — он будет вида:
   ```
   https://ваш-домен.bitrix24.ru/rest/USER_ID/WEBHOOK_CODE/
   ```

### 4. Настроить окружение

Запустить Claude Code в папке проекта и выполнить:

```
/setup-env
```

Или создать файл `.env` вручную:

```bash
cat > .env << 'EOF'
export BITRIX24_WEBHOOK_URL="https://ваш-домен.bitrix24.ru/rest/USER_ID/WEBHOOK_CODE/"
export PROJECTS_DIRS="~/Projects"
EOF
```

`PROJECTS_DIRS` — папки с git-проектами для сводок активности. Несколько папок через `:`:

```bash
export PROJECTS_DIRS="~/Projects:~/work/clients"
```

### 5. Проверить

В Claude Code:

```
покажи мои задачи в битриксе
```

## Как это работает

Claude Code автоматически подхватывает скиллы из папки `.claude/skills/`. Каждый скилл — это markdown-файл с инструкциями для Claude: какие API вызывать, как форматировать ответ, когда спрашивать подтверждение. Вы общаетесь с Claude на естественном языке, а он сам выбирает нужный скилл и выполняет запросы к Битрикс24 через REST API.

## Доступные скиллы

| Скилл | Что делает | Как вызвать |
|-------|-----------|-------------|
| **bitrix24-tasks** | Просмотр, создание, обновление задач | «покажи мои задачи», «создай задачу» |
| **bitrix24-task-changes** | Дедлайн, комментарии, трудозатраты, история | «поменяй дедлайн», «добавь 2 часа», «напиши в задачу» |
| **bitrix24-chats** | Чтение чатов и переписок | «покажи чаты», «что писали в чате» |
| **daily-review** | Сводка за день: чаты, задачи, встречи, git | «обзор дня», «что нового» |
| **weekly-review** | Сводка за неделю + git-активность | «обзор недели», «итоги недели» |
| **setup-env** | Настройка вебхука | «настроить окружение» |

## Структура

```
.claude/
├── skills/
│   ├── bitrix24-tasks/SKILL.md       # CRUD задач, активность за период
│   ├── bitrix24-task-changes/SKILL.md # Модификации: дедлайн, комменты, время
│   ├── bitrix24-chats/SKILL.md        # Чтение мессенджера
│   ├── daily-review/SKILL.md          # Сводка дня
│   ├── weekly-review/SKILL.md         # Сводка недели
│   └── setup-env/SKILL.md             # Настройка .env
├── agents/
│   ├── activity-data-collector.md     # Сбор git-активности (текущий проект)
│   └── project-activity-digest.md     # Сводка по проектам (PROJECTS_DIRS)
└── rules/
    └── subagents.md                   # Правила вызова субагентов
```

## Безопасность

- `.env` с вебхуком **не коммитится** (в `.gitignore`)
- `*.local.json` с локальными настройками **не коммитятся**
- Вебхук привязан к конкретному пользователю — не передавайте его третьим лицам
- При увольнении сотрудника — деактивируйте его вебхук в Битрикс24
